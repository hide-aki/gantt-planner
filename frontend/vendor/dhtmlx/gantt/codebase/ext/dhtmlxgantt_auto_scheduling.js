/*
@license

dhtmlxGantt v.4.2.0 Professional
This software is covered by DHTMLX Commercial License. Usage without proper license is prohibited.

(c) Dinamenta, UAB.
*/
gantt._formatLink=function(t){var n=[],a=this._get_link_target(t),e=this._get_link_source(t);if(!e||!a)return n;if(gantt.isChildOf(e.id,a.id)&&gantt._isProject(a)||gantt.isChildOf(a.id,e.id)&&gantt._isProject(e))return n;for(var i=this._getImplicitLinks(t,e,function(t){return 0}),r=gantt.config.auto_scheduling_move_projects,g=this._isProject(a)?this.getSubtaskDates(a.id):{start_date:a.start_date,end_date:a.end_date},s=this._getImplicitLinks(t,a,function(t){return r?t.$target.length||gantt.getState().drag_id==t.id?0:gantt.calculateDuration({
start_date:g.start_date,end_date:t.start_date,task:e}):0}),o=0;o<i.length;o++)for(var u=i[o],c=0;c<s.length;c++){var l=s[c],d=1*u.lag+1*l.lag,h={id:t.id,type:t.type,source:u.task,target:l.task,lag:(1*t.lag||0)+d};n.push(gantt._convertToFinishToStartLink(l.task,h,e,a))}return n},gantt._getImplicitLinks=function(t,n,a){var e=[];return this._isProject(n)?this.eachTask(function(t){this._isProject(t)||e.push({task:t.id,lag:a(t)})},n.id):e.push({task:n.id,lag:0}),e},gantt._getDirectDependencies=function(t,n){
for(var a=[],e=[],i=n?t.$source:t.$target,r=0;r<i.length;r++){var g=this.getLink(i[r]);this.isTaskExists(g.source)&&this.isTaskExists(g.target)&&a.push(this.getLink(i[r]))}for(var r=0;r<a.length;r++)e=e.concat(this._formatLink(a[r]));return e},gantt._getInheritedDependencies=function(t,n){var a=[],e=[];if(this.isTaskExists(t.id)){this._eachParent(function(t){this._isProject(t)&&e.push.apply(e,this._getDirectDependencies(t,n))},t.id,this);for(var i=0;i<e.length;i++){var r=n?e[i].source:e[i].target;
r==t.id&&a.push(e[i])}}return a},gantt._getDirectSuccessors=function(t){return this._getDirectDependencies(t,!0)},gantt._getInheritedSuccessors=function(t){return this._getInheritedDependencies(t,!0)},gantt._getDirectPredecessors=function(t){return this._getDirectDependencies(t,!1)},gantt._getInheritedPredecessors=function(t){return this._getInheritedDependencies(t,!1)},gantt._getSuccessors=function(t){return this._getDirectSuccessors(t).concat(this._getInheritedSuccessors(t))},gantt._getPredecessors=function(t){
return this._getDirectPredecessors(t).concat(this._getInheritedPredecessors(t))},gantt._convertToFinishToStartLink=function(t,n,a,e){var i={target:t,link:gantt.config.links.finish_to_start,id:n.id,lag:n.lag||0,source:n.source,preferredStart:null},r=0;switch(n.type){case gantt.config.links.start_to_start:r=-a.duration;break;case gantt.config.links.finish_to_finish:r=-e.duration;break;case gantt.config.links.start_to_finish:r=-a.duration-e.duration;break;default:r=0}return i.lag+=r,i},gantt.config.auto_scheduling=!1,
gantt.config.auto_scheduling_descendant_links=!1,gantt.config.auto_scheduling_initial=!0,gantt.config.auto_scheduling_strict=!1,gantt.config.auto_scheduling_move_projects=!0,gantt._forEach=function(t,n){for(var a=t.slice(),e=0;e<a.length;e++)n(a[e],e)},gantt._arrayMap=function(t,n){for(var a=t.slice(),e=[],i=0;i<a.length;i++)e.push(n(a[i],i));return e},gantt._autoSchedulingGraph={getVertices:function(t){var n={};gantt._forEach(t,function(t){n[t.target]=t.target,n[t.source]=t.source});var a=[];for(var e in n)a.push(n[e]);
return a.sort(function(t,n){return gantt.getGlobalTaskIndex(t)-gantt.getGlobalTaskIndex(n)})},topologicalSort:function(t){for(var n=this.getVertices(t),a={},e=0;e<n.length;e++)a[n[e]]={id:n[e],$source:[],$target:[],$incoming:0};for(var e=0;e<t.length;e++){var i=a[t[e].target];i.$target.push(e),i.$incoming=i.$target.length,a[t[e].source].$source.push(e)}for(var r=n.filter(function(t){return!a[t].$incoming}),g=[];r.length;){var s=r.pop();g.push(s);for(var o=a[s],e=0;e<o.$source.length;e++){var u=a[t[o.$source[e]].target];
u.$incoming--,u.$incoming||r.push(u.id)}}return g},tarjanStronglyConnectedComponents:function(t,n){function a(t,i){var u=e(t);if(u.index=r,u.lowLink=r,r++,i&&s.push(i),g.push(u),u.onStack=!0,gantt._forEach(n,function(n){if(n.source==t){var i=e(n.source),r=e(n.target);void 0===r.index?(a(n.target,n),i.lowLink=Math.min(i.lowLink,r.lowLink)):r.onStack&&(i.lowLink=Math.min(i.lowLink,r.index),s.push(n))}}),u.lowLink==u.index){var c,l={tasks:[],links:[]};do{var d=s.pop();c=g.pop(),c.onStack=!1,l.tasks.push(c.id),
d&&l.links.push(d.id)}while(c.id!=u.id);o.push(l)}}function e(t){return i[t]||(i[t]={id:t}),i[t]}var i={},r=0,g=[],s=[],o=[];return gantt._forEach(t,function(t){var n=e(t);void 0===n.index&&a(t)}),o}},gantt._autoSchedulingPath={getKey:function(t){return[t.lag,t.link,t.source,t.target].join("_")},getVirtualRoot:function(){return gantt.mixin(gantt.getSubtaskDates(),{id:gantt.config.root_id,type:gantt.config.types.project,$source:[],$target:[],$virtual:!0})},filterDuplicates:function(t){for(var n={},a=0;a<t.length;a++){
var e=this.getKey(t[a]);n[e]?(t.splice(a,1),a--):n[e]=!0}return t},getLinkedTasks:function(t,n){for(var a=[t],e=[],i={},r=0;r<a.length;r++)e=e.concat(this._getLinkedTasks(a[r],i,n));return e},_getLinkedTasks:function(t,n,a){var e=void 0===t?gantt.config.root_id:t,i=n||{},r=gantt.isTaskExists(e)?gantt.getTask(e):this.getVirtualRoot(),g=gantt._getSuccessors(r);a&&g.push.apply(g,gantt._getPredecessors(r));for(var s=[],o=0;o<g.length;o++)i[this.getKey(g[o])]||(i[this.getKey(g[o])]=!0,s=s.concat(this._getLinkedTasks(g[o].target,i,!0)));
for(var u=gantt.getChildren(r.id),o=0;o<u.length;o++)g=g.concat(this._getLinkedTasks(u[o],i,!0));return this.filterDuplicates(g.concat(s))},findLoops:function(t){var n=[];gantt._forEach(t,function(t){t.target==t.source&&n.push([t.target,t.source])});var a=gantt._autoSchedulingGraph,e=a.getVertices(t),i=a.tarjanStronglyConnectedComponents(e,t);return gantt._forEach(i,function(t){t.tasks.length>1&&n.push(t)}),n}},gantt._autoSchedulingDateResolver={isFirstSmaller:function(t,n,a){return t.valueOf()<n.valueOf()&&gantt._hasDuration(t,n,a)?!0:!1;
},isSmallerOrDefault:function(t,n,a){return!(t&&!this.isFirstSmaller(t,n,a))},resolveRelationDate:function(t,n,a){for(var e=null,i=null,r=null,g=0;g<n.length;g++){var s=n[g];t=s.target,r=s.preferredStart;var o=this.getConstraintDate(s,a);this.isSmallerOrDefault(r,o,gantt.getTask(t))&&this.isSmallerOrDefault(e,o,gantt.getTask(t))&&(e=o,i=s.id)}return e&&(e=gantt.getClosestWorkTime({date:e,dir:"future",task:gantt.getTask(t)})),{link:i,task:t,start_date:e}},getConstraintDate:function(t,n){var a=n(t.source);
return a&&t.lag&&1*t.lag==t.lag&&(a=gantt.calculateEndDate({start_date:a,duration:1*t.lag,task:gantt.getTask(t.source)})),a}},gantt._autoSchedulingPlanner={generatePlan:function(t){function n(t){var n=r[t],a=gantt.getTask(t);return n&&(n.start_date||n.end_date)?n.end_date?n.end_date:gantt.calculateEndDate({start_date:n.start_date,duration:a.duration,task:a}):gantt.getClosestWorkTime({date:a.end_date,dir:"future",task:a})}var a=gantt._autoSchedulingGraph,e=a.topologicalSort(t),i={},r={};gantt._arrayMap(e,function(t){
var n=gantt.getTask(t);n.auto_scheduling!==!1&&(i[t]=[],r[t]=null)});for(var g=0;g<t.length;g++)i[t[g].target]&&i[t[g].target].push(t[g]);for(var s=gantt._autoSchedulingDateResolver,o=[],g=0;g<e.length;g++){var u=e[g],c=s.resolveRelationDate(u,i[u]||[],n);if(c.start_date&&gantt.isLinkExists(c.link)){var l=gantt.getLink(c.link),d=gantt.getTask(u),h=gantt.getTask(l.source);if(d.start_date.valueOf()!==c.start_date.valueOf()&&gantt.callEvent("onBeforeTaskAutoSchedule",[d,c.start_date,l,h])===!1)continue;
}r[u]=c,c.start_date&&o.push(c)}return o},applyProjectPlan:function(t){for(var n,a,e,i,r=[],g=0;g<t.length;g++)if(e=null,i=null,n=t[g],n.task){a=gantt.getTask(n.task),n.link&&(e=gantt.getLink(n.link),i=gantt.getTask(e.source));var s=null;n.start_date&&a.start_date.valueOf()!=n.start_date.valueOf()&&(s=n.start_date),s&&(a.start_date=s,a.end_date=gantt.calculateEndDate(a),r.push(a.id),gantt.callEvent("onAfterTaskAutoSchedule",[a,s,e,i]))}return r}},gantt._autoSchedulingPreferredDates=function(t,n){
for(var a=0;a<n.length;a++){var e=n[a],i=gantt.getTask(e.target);gantt.config.auto_scheduling_strict&&e.target!=t||(e.preferredStart=new Date(i.start_date))}},gantt._autoSchedule=function(t,n,a){if(gantt.callEvent("onBeforeAutoSchedule",[t])!==!1){gantt._autoscheduling_in_progress=!0;var e=gantt._autoSchedulingPath,i=[],r=e.findLoops(n);if(r.length)gantt.callEvent("onAutoScheduleCircularLink",[r]);else{var g=gantt._autoSchedulingPlanner;gantt._autoSchedulingPreferredDates(t,n);var s=g.generatePlan(n);
i=g.applyProjectPlan(s),a&&a(i)}return gantt._autoscheduling_in_progress=!1,gantt.callEvent("onAfterAutoSchedule",[t,i]),i}},gantt.autoSchedule=function(t,n){n=void 0===n?!0:!!n;var a=gantt._autoSchedulingPath.getLinkedTasks(t,n);gantt._autoSchedule(t,a,gantt._finalizeAutoSchedulingChanges)},gantt._finalizeAutoSchedulingChanges=function(t){function n(t){if(!e){var a=t.start_date.valueOf(),i=t.end_date.valueOf();if(gantt.resetProjectDates(t),t.start_date.valueOf()!=a||t.end_date.valueOf()!=i)return void(e=!0);
for(var r=gantt.getChildren(t.id),g=0;!e&&g<r.length;g++)n(gantt.getTask(r[g]))}}function a(){for(var n=0;n<t.length;n++)gantt.updateTask(t[n])}var e=!1;1==t.length?gantt._eachParent(n,t[0]):t.length&&(e=!0),e?gantt.batchUpdate(a):a()},gantt.isCircularLink=function(t){return!!gantt._getConnectedGroup(t)},gantt._getConnectedGroup=function(t){var n=gantt._autoSchedulingPath,a=n.getLinkedTasks();gantt.isLinkExists(t.id)||(a=a.concat(gantt._formatLink(t)));for(var e=n.findLoops(a),i=!1,r=0;r<e.length&&!i;r++)for(var g=e[r].links,s=0;s<g.length;s++)if(g[s]==t.id)return e[r];
return null},gantt.findCycles=function(){var t=gantt._autoSchedulingPath,n=t.getLinkedTasks();return t.findLoops(n)},gantt._attachAutoSchedulingHandlers=function(){function t(t,n){for(var a=!1,e=0;e<n.length;e++){var i=gantt.getLink(n[e].id);(i.type==gantt.config.links.start_to_start||i.type==gantt.config.links.start_to_finish)&&(n.splice(e,1),e--,a=!0)}if(a){for(var r={},e=0;e<n.length;e++)r[n[e].id]=!0;for(var g=gantt._autoSchedulingPath.getLinkedTasks(t,!0),e=0;e<g.length;e++)r[g[e].id]||n.push(g[e]);
}}gantt._autoScheduleAfterLinkChange=function(t,n){gantt.config.auto_scheduling&&!this._autoscheduling_in_progress&&gantt.autoSchedule(n.source)},gantt.attachEvent("onAfterLinkUpdate",gantt._autoScheduleAfterLinkChange),gantt.attachEvent("onAfterLinkAdd",gantt._autoScheduleAfterLinkChange),gantt.attachEvent("onParse",function(){gantt.config.auto_scheduling&&gantt.config.auto_scheduling_initial&&gantt.autoSchedule()}),gantt._preventCircularLink=function(t,n){return gantt.isCircularLink(n)?(gantt.callEvent("onCircularLinkError",[n,gantt._getConnectedGroup(n)]),
!1):!0},gantt._preventDescendantLink=function(t,n){var a=gantt.getTask(n.source),e=gantt.getTask(n.target);return!gantt.config.auto_scheduling_descendant_links&&(gantt.isChildOf(a.id,e.id)&&gantt._isProject(e)||gantt.isChildOf(e.id,a.id)&&gantt._isProject(a))?!1:!0},gantt.attachEvent("onBeforeLinkAdd",gantt._preventCircularLink),gantt.attachEvent("onBeforeLinkAdd",gantt._preventDescendantLink),gantt.attachEvent("onBeforeLinkUpdate",gantt._preventCircularLink),gantt.attachEvent("onBeforeLinkUpdate",gantt._preventDescendantLink),
gantt._datesNotEqual=function(t,n,a,e){return t.valueOf()>n.valueOf()?this._hasDuration({start_date:n,end_date:t,task:e}):this._hasDuration({start_date:t,end_date:n,task:a})},gantt._notEqualTaskDates=function(t,n){return this._datesNotEqual(t.start_date,n.start_date,t,n)||(this._datesNotEqual(t.end_date,n.end_date,t,n)||t.duration!=n.duration)&&t.type!=gantt.config.types.milestone?!0:void 0};var n,a;gantt.attachEvent("onBeforeTaskDrag",function(t,e,i){return gantt.config.auto_scheduling_move_projects&&(n=gantt._autoSchedulingPath.getLinkedTasks(t,!0),
a=t),!0}),gantt._autoScheduleAfterDND=function(e,i){if(gantt.config.auto_scheduling&&!this._autoscheduling_in_progress){var r=this.getTask(e);gantt._notEqualTaskDates(i,r)&&(gantt.config.auto_scheduling_move_projects&&a==e?(gantt.calculateDuration(i)!=gantt.calculateDuration(r)&&t(e,n),gantt._autoSchedule(e,n,gantt._finalizeAutoSchedulingChanges)):gantt.autoSchedule(r.id))}return n=null,a=null,!0},gantt._lightBoxChangesHandler=function(t,n){if(gantt.config.auto_scheduling&&!this._autoscheduling_in_progress){
var a=this.getTask(t);gantt._notEqualTaskDates(n,a)&&(gantt._autoschedule_lightbox_id=t)}return!0},gantt._lightBoxSaveHandler=function(t,n){return gantt.config.auto_scheduling&&!this._autoscheduling_in_progress&&gantt._autoschedule_lightbox_id&&gantt._autoschedule_lightbox_id==t&&(gantt._autoschedule_lightbox_id=null,gantt.autoSchedule(n.id)),!0},gantt.attachEvent("onBeforeTaskChanged",function(t,n,a){return gantt._autoScheduleAfterDND(t,a)}),gantt.attachEvent("onLightboxSave",gantt._lightBoxChangesHandler),
gantt.attachEvent("onAfterTaskUpdate",gantt._lightBoxSaveHandler)},gantt.attachEvent("onGanttReady",function(){gantt._attachAutoSchedulingHandlers()});
//# sourceMappingURL=../sources/ext/dhtmlxgantt_auto_scheduling.js.map